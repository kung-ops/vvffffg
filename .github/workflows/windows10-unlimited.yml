name: Windows Server Build
on: 
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:  # Manual trigger

jobs:
  build:
    runs-on: windows-latest  # Windows Server 2022
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Show Windows Server Info
      run: |
        echo "=== Windows Server Information ==="
        systeminfo | findstr /C:"OS Name" /C:"OS Version"
        echo "CPU Cores: $env:NUMBER_OF_PROCESSORS"
        echo "Architecture: $env:PROCESSOR_ARCHITECTURE"
        
    - name: Setup Environment
      run: |
        # Display disk info
        Get-PSDrive C | Format-List Name, Used, Free, @{Name="Free(GB)";Expression={[math]::Round($_.Free/1GB,2)}}, @{Name="Total(GB)";Expression={[math]::Round(($_.Free+$_.Used)/1GB,2)}}
        
        # Check available tools
        dotnet --version || echo "No .NET"
        python --version || echo "No Python"
        node --version || echo "No Node.js"
        
    - name: Install Chocolatey Packages
      run: |
        # Install package manager if needed
        Set-ExecutionPolicy Bypass -Scope Process -Force
        [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
        iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
        
        # Install common tools
        choco install -y git.install
        choco install -y 7zip
        choco install -y vscode
        
    - name: Build .NET Project (Example)
      run: |
        # Create a simple .NET project if none exists
        if (Test-Path "*.csproj" -PathType Leaf) {
            dotnet restore
            dotnet build --configuration Release
            dotnet test
        } else {
            echo "No .NET project found, skipping build"
        }
        
    - name: Create Artifacts
      run: |
        # Create some output
        mkdir -Force dist
        echo "Build completed on Windows Server" > dist/build-info.txt
        date >> dist/build-info.txt
        systeminfo | findstr /C:"OS Name" >> dist/build-info.txt
        
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: windows-server-build
        path: |
          dist/
          bin/Release/
